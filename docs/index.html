<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adaptive Benefit Questionnaire</title>
  <meta name="description" content="Adaptive benefits questionnaire" />
  <style>
    body{font-family: Georgia, 'Times New Roman', serif;background:#f8f9fa;color:#333;margin:0}
    .wrap{max-width:1100px;margin:32px auto;background:#fff;border:1px solid #e0e0e0;border-radius:16px;padding:28px;box-shadow:0 4px 16px rgba(0,0,0,0.08)}
    .title{font-size:2rem;text-align:center;margin:4px 0 12px 0}
    .subtitle{text-align:center;color:#666;margin:0 0 16px 0}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    label{font-weight:600;margin-bottom:6px}
    input,select{padding:12px;border:1px solid #ccc;border-radius:8px;font-family:inherit}
    .btn{background:#d24545;color:#fff;border:1px solid #d24545;padding:12px 16px;border-radius:8px;font-weight:600;cursor:pointer}
    .btn:hover{background:#6b0f1a;border-color:#6b0f1a}
    .choices{display:grid;grid-template-columns:repeat(2,minmax(280px,1fr));gap:18px;max-width:820px;margin:0 auto}
    .choice{background:#fff;border:2px solid #e0e0e0;padding:24px;border-radius:12px;cursor:pointer;text-align:left}
    .hidden{display:none}
    .rec{background:#fff;border-left:5px solid #6b0f1a;padding:18px;margin-bottom:14px;border-radius:8px;border:1px solid #f0f0f0}
  </style>
  <script src="./config.js"></script>
  <script>
    const api = (p) => (window.API_BASE ? window.API_BASE + p : p);
    let sessionId = null; let currentQuestionId = null;
    async function startQuestionnaire(){
      const d = (id)=>document.getElementById(id).value;
      const body = {
        name:d('name'), age:d('age'), marital_status:d('marital_status'), num_children:d('num_children'),
        annual_income:d('annual_income'), monthly_expenses:d('monthly_expenses'), total_debt:d('total_debt'), savings:d('savings'), investment_accounts:0
      };
      const r = await fetch(api('/api/start'),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
      const data = await r.json(); sessionId = data.session_id; document.getElementById('profile').classList.add('hidden');
      document.getElementById('q').classList.remove('hidden'); renderQ(data.question);
    }
    function renderQ(q){ currentQuestionId=q.id; document.getElementById('qText').textContent=q.text; const c = document.getElementById('qChoices'); c.innerHTML='';
      q.choices.forEach((t,i)=>{ const b=document.createElement('button'); b.className='choice'; b.textContent=t; b.onclick=()=>submitAnswer(i); c.appendChild(b); }); }
    async function submitAnswer(choice){ const r=await fetch(api('/api/answer'),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({session_id:sessionId,question_id:currentQuestionId,choice})}); const data=await r.json(); if(data.complete){
        document.getElementById('q').classList.add('hidden'); document.getElementById('res').classList.remove('hidden');
        document.getElementById('pdf').href = api('/api/generate-pdf/'+data.session_id);
        const cont = document.getElementById('recs'); cont.innerHTML='';
        data.recommendations.forEach(rec=>{ const div=document.createElement('div'); div.className='rec'; div.innerHTML=`<div style="display:flex;justify-content:space-between"><strong>${rec.benefit.replace(/_/g,' ')}</strong><span style="color:#6b0f1a">${rec.score}/100</span></div><div>${rec.rationale||''}</div>`; cont.appendChild(div); });
      } else { renderQ(data.question); }
    }
  </script>
  </head>
<body>
  <div class="wrap">
    <div id="profile">
      <div class="title">Adaptive Benefit Questionnaire</div>
      <div class="subtitle">Answer a few smart questions to personalize your benefits</div>
      <div class="grid">
        <div><label>Name</label><input id="name" value="John Doe" /></div>
        <div><label>Age</label><input id="age" type="number" value="35" /></div>
        <div><label>Marital Status</label><select id="marital_status"><option value="single">Single</option><option value="married" selected>Married</option><option value="divorced">Divorced</option></select></div>
        <div><label>Number of Children</label><input id="num_children" type="number" value="0" /></div>
        <div><label>Annual Income ($)</label><input id="annual_income" type="number" value="120000" /></div>
        <div><label>Monthly Expenses ($)</label><input id="monthly_expenses" type="number" value="5000" /></div>
        <div><label>Total Debt ($)</label><input id="total_debt" type="number" value="20000" /></div>
        <div><label>Savings ($)</label><input id="savings" type="number" value="25000" /></div>
      </div>
      <div style="margin-top:16px"><button class="btn" onclick="startQuestionnaire()">Start Questionnaire</button></div>
    </div>

    <div id="q" class="hidden">
      <h3 id="qText"></h3>
      <div id="qChoices" class="choices"></div>
    </div>

    <div id="res" class="hidden">
      <div style="display:flex;gap:12px;margin:12px 0 16px 0">
        <a id="pdf" class="btn" href="#" download>Download Comprehensive PDF</a>
        <button class="btn" onclick="location.reload()">Start New Assessment</button>
      </div>
      <div id="recs"></div>
    </div>
  </div>
  </body>
  </html>
